# ミニラボ: Azure 多要素認証を使用したユーザー サインイン イベントを保護する

多要素認証（MFA）は、サインイン イベント中にユーザーに追加の識別形式を要求するプロセスです。ユーザーは、携帯電話にコードを入力するか、指紋スキャンを提供するように求められる場合があります。2 番目の認証形式を要求すると、攻撃者が取得または複製することが容易ではないため、セキュリティが強化されます。

Azure 多要素認証および条件付きアクセスポリシーは、特定のサインインイベント中にユーザーがMFAを有効にできる柔軟性を提供します。

**前提条件**

このミニラボを実行するには次のリソースと権限が必要であるため、このラボは**講師用デモ**として実行されることを想定しています。

* Azure AD Premium または試用ライセンスが有効になっている、有効な Azure AD テナント。 

* グローバル管理者権限を持つアカウント。

* testuser など、パスワードがわかっている非管理者ユーザー。このミニラボでは、このアカウントを使用してエンド ユーザーの Azure Multi-Factor Authentication エクスペリエンスをテストします。 


* 管理者以外のユーザーがメンバーになっているグループ（MFA-Test-Groupなど）。このミニラボでは、このグループの Azure Multi-Factor Authentication を有効にします。 


## 条件付きアクセスポリシーを作成する

Azure Multi-Factor Authentication を有効にして使用するための推奨される方法は、条件付きアクセス ポリシーを使用することです。条件付きアクセスでは、サインイン イベントに対応するポリシーを作成および定義し、ユーザーにアプリケーションまたはサービスへのアクセスが許可される前に追加のアクションを要求できます。

![サインイン プロセスを保護するための条件付きアクセスの動作の概要図](../../Linked_Image_Files/demo_conditional_access_image1.png)

このミニラボでは、ユーザーが Azure portal にサインインしたときに MFA を要求する基本的な条件付きアクセス ポリシーを作成します。 

最初に、条件付きアクセス ポリシーを作成し、次のようにユーザーのテスト グループを割り当てます。

1. グローバル管理者のアクセス許可を使用して [Azure portal](https://portal.azure.com/) にサインインします。

1. **Azure Active Directory** を検索および選択し、左側のメニューの 「**セキュリティ** 」 を選択します

1. 同じく左側のメニューの 「**条件付きアクセス** 」 を選択し、「**+ 新しいポリシー** 」 を選択します。   

1. *MFA パイロット*など、ポリシーの名前を入力します 。

1. 「**課題** 」 で、「**ユーザーとグループ** 」 を選択し、次に 「**ユーザーとグループを選択** 」 を選択します。

1. 「**ユーザーとグループ** 」 のチェックボックスをオンにして、「**選択** 」 をクリックします。

1. *MFA-Test-Group* のような Azure AD グループを参照して選択し、次に 「**選択** 」 を選択します。

    [![図 3](../../Linked_Image_Files/conditional_access_image2.png)](https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/media/tutorial-enable-azure-mfa/select-group-for-conditional-access.png#lightbox)

1. グループに条件付きアクセス ポリシーを適用するには、 **完了**を選択します。

## 多要素認証の条件を構成します

条件付きアクセス ポリシーが作成され、ユーザーのテスト グループが割り当てられていると、ポリシーをトリガーするクラウド アプリまたはアクションを定義できるようになります。これらのクラウド アプリまたはアクションは、MFA のダイアログを表示するなどの追加処理が必要であると判断したシナリオです。 

ユーザーが Azure portal にサインインするときに MFAを要求するように条件付きアクセス ポリシーを構成します。

1. 「**クラウド アプリまたは操作** 」 を選択します。条件付きアクセス ポリシーを *すべてのクラウドアプリ* または *アプリの選択*に適用することを選択できます

1. 「**含める** 」 ページで、「**アプリの選択** 」 を選択します。

1. **選択する**を選び、使用可能なサインイン イベントのリストを参照します。

1. **Microsoft Azure の管理**を選び、 ポリシーが Azure portal へのサインインイベントに適用されるようにします。

1. 選択したアプリを適用するには、 **選択**、次に **完了**を選択します。

    ![Microsoft Azure 管理アプリを選択し、条件付きアクセスポリシーに含めます。](../../Linked_Image_Files/demo_conditional_access_image3.png)

1. アクセス制御を使用すると、承認されたクライアント アプリが必要であったり、Hybrid Azure AD が参加しているデバイスを使用したりするなど、ユーザーにアクセスを許可するための要件を定義できます。Azure portal へのサインイン イベント中に MFA を要求するようにアクセス制御を構成します。

1. 「**アクセス制御** 」 の下で、「**許可** 」 を選択し、「**アクセス権の付与** 」 が選択されていることを確認します。

1. **多要素認証を要求する**のチェックボックスをオンにし、**選択**を選びます。

    条件付きアクセス ポリシーは、構成がユーザーに与える影響を確認する場合は 「レポートのみ 」 に設定し、ポリシーを今すぐ使用しない場合は 「オフ 」 に設定できます。このデモの対象となるユーザーのテスト グループが作成されたため、ポリシーを有効にしてから Azure Multi-Factor Authentication をテストしましょう。

1. *ポリシーの有効化*を**オン**に設定します

1. *条件付きアクセス ポリシー*適用するには、**作成する**を選択します。

## Azure Multi-Factor Authentication をテストする

条件付きアクセス ポリシーと Azure Multi-Factor Authentication を表示するには、次のように MFA を必要としないリソースにサインインします。

1. InPrivate またはシークレット モードで新しいブラウザーの画面を開き、[ https://account.activedirectory.windowsazure.com ](https://account.activedirectory.windowsazure.com/)にアクセスします。

1. testuser などの管理者以外のテスト ユーザーでサインインします。MFA を完了するためのプロンプトはありません。

1. ブラウザウィンドウを閉じます。

    Azure portal にサインインします。Azure portal は、追加の検証を必要とする条件付きアクセス ポリシーで構成されているため、Azure Multi-Factor Authentication のダイアログが表示されます。

1. InPrivate モードまたはシークレット モードで新しいブラウザーの画面を開き、[https://portal.azure.com](https://portal.azure.com/) を参照します

1. testuser などの管理者以外のテスト ユーザーでサインインします。Azure Multi-Factor Authentication に登録して使用する必要があります。プロンプトに従ってプロセスを完了し、Azure portal に正常にサインインしたことを確認します。

    ![ブラウザーのプロンプトに従い、登録済みの多要素認証プロンプトでサインインします](../../Linked_Image_Files/demo_conditional_access_image4.png)
