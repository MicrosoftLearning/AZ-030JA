# ミニラボ: Azure AD パスワード リセットのセルフサービスを有効にする

Azure Active Directory (Azure AD) のパスワード リセットのセルフサービス (SSPR) を使用すると、ユーザーは管理者やヘルプ デスクに関与していない状態でパスワードを変更またはリセットできます。ユーザーのアカウントがロックされているか、パスワードを忘れた場合、ユーザーはプロンプトに従って自分のブロックを解除し、作業に戻ることができます。この機能により、ユーザーがデバイスやアプリケーションにサインインできない場合のヘルプデスクへの問い合わせや生産性の損失が減少します。

このトピックでは、パスワード リセットのセルフサービスを有効にする方法を示します。 

* Azure AD ユーザーのグループのパスワード リセットのセルフサービスを有効にする

* 認証方法と登録オプションを構成する

* ユーザーとして SSPR プロセスをテストする

## 前提条件

このミニラボを実行するには次のリソースと権限が必要であるため、このラボは**講師用デモ**として実行されることを想定しています。

* 少なくとも試用ライセンスが有効になっている、機能している Azure AD テナント。 

* グローバル管理者権限を持つアカウント。

* testuser など、パスワードがわかっている非管理者ユーザー。このミニラボでは、このアカウントを使用してエンドユーザー SSPR エクスペリエンスをテストします。 

* 管理者以外のユーザーがメンバーになっているグループ（SSPR-Test-Groupなど）。このミニラボでは、このグループの SSPR を有効にします。 

## パスワード リセットのセルフサービス を有効にする

Azure AD では、 `なし`、`選択済み`、または `すべてのユーザー` に対して SSPR を有効にできます。このきめ細かい機能により、ユーザーのサブセットを選択して SSPR 登録プロセスとワークフローをテストできます。プロセスに問題がなく、幅広いユーザー セットと要件を伝達できる場合は、SSPR を有効にする追加のユーザー グループを選択できます。または、Azure AD テナントのすべてのユーザーに対して SSPR を有効にすることができます。

このミニラボでは、テスト グループ内のユーザーのセットに対して SSPR を構成します。次の例では、「`SSPR-Test-Group`」グループを使用します。必要に応じて独自の Azure AD グループを提供します。

1. グローバル管理者のアクセス許可を使用して [Azure portal](https://portal.azure.com/) にサインインします。

1. **Azure Active Directory** を検索して選択し、次に左側のメニューから 「**パスワードのリセット** 」 を選択します。

1. 「**プロパティ** 」 ページから、「パスワード リセットの `セルフサービス` が有効 」 オプションで、「**グループの選択** 」 を選択します。

1. 「*SSPR-Test-Group*」のような Azure AD グループを検索して選択してから、「**選択** 」 を選択します。

    [![パスワード リセットのセルフサービス を有効にする](../../Linked_Image_Files/how_to_setup_sspr_image1.png)](https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/media/tutorial-enable-sspr/enable-sspr-for-group.png#lightbox)

    入れ子になったグループは、SSPR の幅広いデプロイの一部としてサポートされます。選択したグループのユーザーに適切なライセンスが割り当てられていることを確認してください。現在、これらのライセンス要件の検証プロセスはありません。

1. 選択したユーザーの SSPR を有効にするには、「**保存** 」 を選択します。

## 認証方法と登録オプションを選択する

ユーザーがアカウントのロックを解除したり、パスワードをリセットしたりする必要がある場合、追加の確認方法の入力を求められます。この追加の認証要素により、承認された SSPR イベントのみが確実に完了します。 
    
> ユーザーが提供する登録情報に基づいて、許可する認証方法を選択できます。

1. 左側のメニューの 「**認証方法** 」 ページで、「**リセットに必要なメソッドの数** 」 を *1* に設定します。

    セキュリティを向上させるために、SSPR に必要な認証方法の番号を増やすことができます。

1. 組織で許可する**ユーザーが利用可能な方法**を選択します。このミニラボでは、次の方法を有効にするチェック ボックスをオンにします。

    - *モバイル アプリの通知*

    - *モバイル アプリの確認コード*

    - *電子メール*

    - *携帯電話*

    - *会社電話*

1. 認証方法を適用するには、 「**保存する** 」 を選択します。

## ユーザーが次回サインインするときに登録を求めるプロンプトを構成する

ユーザーは、アカウントのロックを解除したり、パスワードをリセットしたりする前に、連絡先情報を登録する必要があります。この連絡先情報は、前の手順で構成されたさまざまな認証方法に使用されます。

管理者は手動でこの連絡先情報を提供できます。または、ユーザーは登録ポータルにアクセスして、自分で情報を提供できます。このミニラボでは、ユーザーが次回サインインするときに登録を求めるプロンプトを表示するように構成します。

1. 左側のメニューの 「**登録** 」 ページで、「**サインイン時にユーザーに登録を要求する** 」 で 「はい 」 を選択します。

2. 連絡先情報を最新の状態に保つことが重要です。SSPR イベントの開始時に連絡先情報が古い場合、ユーザーはアカウントのロックを解除したり、パスワードをリセットしたりできない場合があります。

1. **ユーザーが認証情報の再確認を求められるまでの日数**を *180* に設定します。

1. 登録設定を適用するには、**保存する**を選択します。

## 通知とカスタマイズを構成する

ユーザーにアカウント アクティビティについて通知するために、SSPR イベントが発生したときに送信されるメール通知を構成できます。これらの通知には、通常のユーザー アカウントと管理者アカウントの両方が含まれます。管理者アカウントの場合、この通知は、特権管理者アカウントのパスワードが SSPR を使用してリセットされたときに、認識の追加レイヤーを提供します。

1. 左側のメニューの 「**通知** 」 ページで、次のオプションを構成します。

    - **パスワードのリセット オプションについてユーザーに通知する**に*はい*と設定します。

    - **他の管理者がパスワードをリセットしたときにすべての管理者に通知する**を*はい*に設定します。

1. 通知設定を適用するには、 「**保存** 」 を選択します。

## パスワード リセットのセルフサービスをテストする

SSPR を有効にして構成したら、前のセクションで選択したグループの一部であるユーザー (Test-SSPR-Group など) を使用して SSPR プロセスをテストします。次の例では、testuser アカウントが使用されています。このミニラボの最初のセクションで、SSPR を有効にしたグループの一部である独自のユーザー アカウントを指定します。

>**注**
パスワード リセットのセルフサービスをテストする場合は、管理者以外のアカウントを使用してください。管理者は常にパスワード リセットのセルフサービスが有効になっており、パスワードをリセットするために 2 つの認証方法を使用する必要があります。

1. 手動登録プロセスの場合、InPrivate またはシークレット モードで新しいブラウザーの画面を開き、 [https://aka.ms/ssprsetup](https://aka.ms/ssprsetup) に移動します。ユーザーを、次回サインインするときにこの登録ポータルに誘導する必要があります。

1. `testuser` などの管理者以外のテスト ユーザーでサインインし、認証方法の連絡先情報を登録します。

1. 完了したら、**問題ありません** とマークされたボタンを選択し、ブラウザーの画面を閉じます。

1. InPrivate モードまたはシークレット モードで新しいブラウザーの画面を開き、[https://aka.ms/sspr](https://aka.ms/sspr) に移動します。

1. `testuser` など管理者以外のテスト ユーザーのアカウント情報、CAPTCHA からの文字を入力してから、「**次へ** 」 を選択します。

    ![ユーザー アカウント情報を入力してパスワードをリセットする](../../Linked_Image_Files/how_to_setup_sspr_image2.png)

1. 確認手順に従ってパスワードをリセットします。完了すると、パスワードがリセットされたという電子メール通知が届きます。
